import javax.swing.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class PostgreSQLTelas extends JFrame {
    private static final String URL = "jdbc:postgresql://localhost:5432/DadosGerais";
    private static final String USER = "postgres"; 
    private static final String PASSWORD = "1234";

     // Componentes da interface gráfica
     private JTextField nameField;
     private JTextField emailField;
     private JButton submitButton;

     public PostgreSQLTelas() {
        // Configurações da janela
        setTitle("Adicionar Usuário");
        setSize(300, 200);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setLayout(null);

        // Campo para nome
        JLabel nameLabel = new JLabel("Nome:");
        nameLabel.setBounds(10, 20, 80, 25);
        add(nameLabel);

        nameField = new JTextField();
        nameField.setBounds(100, 20, 160, 25);
        add(nameField);

        // Campo para email
        JLabel emailLabel = new JLabel("Email:");
        emailLabel.setBounds(10, 60, 80, 25);
        add(emailLabel);

        emailField = new JTextField();
        emailField.setBounds(100, 60, 160, 25);
        add(emailField);

        // Botão para adicionar o usuário
        submitButton = new JButton("Adicionar");
        submitButton.setBounds(100, 100, 160, 25);
        add(submitButton);

        // Listener do botão
        submitButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                String name = nameField.getText();
                String email = emailField.getText();
                addUserToDatabase(name, email);  // Chama o método para adicionar os dados no banco
            }
        });
    }

    // Método para adicionar o usuário ao banco de dados
    public void addUserToDatabase(String name, String email) {
        String sql = "INSERT INTO cadastrousers (nome, email) VALUES (?, ?)";

        try (Connection conn = DriverManager.getConnection(URL, USER, PASSWORD);
             PreparedStatement pstmt = conn.prepareStatement(sql)) {

            // Definir os parâmetros para o INSERT
            pstmt.setString(1, name);
            pstmt.setString(2, email);

            // Executar a inserção
            pstmt.executeUpdate();
            JOptionPane.showMessageDialog(this, "Usuário adicionado com sucesso!");

        } catch (SQLException e) {
            e.printStackTrace();
            JOptionPane.showMessageDialog(this, "Erro ao adicionar o usuário.", "Erro", JOptionPane.ERROR_MESSAGE);
        }
    }
    
    public static void main(String[] args) {
        // Executa a interface gráfica
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                PostgreSQLTelas form = new PostgreSQLTelas();
                form.setVisible(true);
            }
        });
    }
}
